// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          Int     @id @default(autoincrement())
  name        String?
  email       String?
  password    String?
  is_verified Boolean @default(false)
  fcm_token   String?

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  transaction Transaction[]
  basket      Basket[]

  @@map("user")
}

model Staff {
  id       Int    @id @default(autoincrement())
  name     String
  login    String
  password String
  status   Status

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("staff")
}

model Region {
  id      Int     @id @default(autoincrement())
  name_ru String
  name_en String
  image   String?
  status  Status

  cities  City[]
  tariffs Tariff[] @relation("tariff_regions")

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("region")
}

model City {
  id      Int    @id @default(autoincrement())
  name_ru String
  name_en String
  status  Status

  region_id Int
  region    Region @relation(fields: [region_id], references: [id])

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("city")
}

model Transaction {
  id     Int    @id @default(autoincrement())
  amount String
  status Status

  user_id Int
  user    User @relation(fields: [user_id], references: [id])

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("transaction")
}

model Tariff {
  id             Int     @id @default(autoincrement())
  name_ru        String
  name_en        String
  title_ru       String?
  title_en       String?
  description_ru String?
  description_en String?
  status         Status
  is_popular     Boolean @default(false)
  is_4g          Boolean @default(false)
  is_5g          Boolean @default(false)

  partner_id Int

  regions Region[]  @relation("tariff_regions")
  partner Partner   @relation(fields: [partner_id], references: [id])
  package Package[]

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("tariff")
}

model Package {
  id            Int    @id @default(autoincrement())
  sms_count     Int?
  minutes_count Int?
  mb_count      Int?
  sku_id        String
  status        Status

  tariff_id Int
  tariff    Tariff @relation(fields: [tariff_id], references: [id])

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("package")
}

model Service {
  id             Int     @id @default(autoincrement())
  name_ru        String
  name_en        String
  description_ru String?
  description_en String?

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("service")
}

model Sims {
  id             Int     @id @default(autoincrement())
  name_ru        String
  name_en        String
  description_ru String?
  description_en String?
  image          String?
  status         Status

  partner_id Int
  partner    Partner @relation(fields: [partner_id], references: [id])

  request  Json
  response Json

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("sims")
}

model Partner {
  id             Int     @id @default(autoincrement())
  name_ru        String
  name_en        String
  description_ru String?
  description_en String?
  image          String?
  status         Status

  sims   Sims[]
  Tariff Tariff[]

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("partner")
}

model Basket {
  id          Int    @id @default(autoincrement())
  amount      String
  status      Status
  total_price String
  user_id     Int
  user        User   @relation(fields: [user_id], references: [id])

  basket_item BasketItem[]

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("basket")
}

model BasketItem {
  id         Int          @id @default(autoincrement())
  basket_id  Int
  tariff_id  Int
  sim_number String?
  price      Float
  status     BasketStatus
  meta       Json?

  basket Basket @relation(fields: [basket_id], references: [id])

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("basket_item")
}

model Error {
  id      Int  @id @default(autoincrement())
  code    Int
  message Json

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("error")
}

enum Status {
  ACTIVE
  INACTIVE
}

enum BasketStatus {
  PENDING
  ORDERED
  ACTIVATED
  FAILED
}
