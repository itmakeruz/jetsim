// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int     @id @default(autoincrement())
  name         String?
  email        String?
  password     String?
  is_verified  Boolean @default(false)
  fcm_token    String?
  phone_number String?
  address      String?
  about        String?
  image        String?

  transaction Transaction[]
  basket      Basket[]
  orders      Order[]
  sims        Sims[]

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("user")
}

model Staff {
  id       Int        @id @default(autoincrement())
  name     String
  login    String
  password String
  role     UserRoles?
  status   Status

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("staff")
}

model SupportOperators {
  id         Int       @id @default(autoincrement())
  name       String?
  login      String?
  password   String?
  status     Status?   @default(ACTIVE)
  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("support_operator")
}

model Region {
  id      Int     @id @default(autoincrement())
  name_ru String
  name_en String
  image   String?
  status  Status

  sims          Sims[]
  tariffs       Tariff[]      @relation("tariff_regions")
  bascet_items  BasketItem[]  @relation("basketitem_to_region")
  region_groups RegionGroup[] @relation("region_to_regiongroup")

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("region")
}

model RegionGroup {
  id      Int     @id @default(autoincrement())
  name_ru String?
  name_en String?
  status  Status  @default(ACTIVE)
  image   String?

  tariffs Tariff[]
  regions Region[] @relation("region_to_regiongroup")

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("region_group")
}

model Transaction {
  id     Int    @id @default(autoincrement())
  amount String
  status Status

  user_id Int
  user    User @relation(fields: [user_id], references: [id])

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("transaction")
}

model Tariff {
  id                Int     @id @default(autoincrement())
  name_ru           String
  name_en           String
  title_ru          String?
  title_en          String?
  status            Status
  partner_id        Int
  is_4g             Boolean @default(false)
  is_5g             Boolean @default(false)
  quantity_sms      Int?
  quantity_minute   Int?
  quantity_internet Int?
  validity_period   Int?
  price_arrival     Int?
  price_sell        Int?
  sku_id            String
  cashback_percent  Int?
  type              Int?
  is_global         Boolean @default(false)
  is_popular        Boolean @default(false)
  is_local          Boolean @default(false)
  is_regional       Boolean @default(false)
  region_group_id   Int?

  regions      Region[]     @relation("tariff_regions")
  region_group RegionGroup? @relation(fields: [region_group_id], references: [id])
  partner      Partner      @relation(fields: [partner_id], references: [id])
  bascet_item  BasketItem[]
  sims         Sims[]

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)
  deleted_at DateTime? @db.Timestamptz(5)

  @@map("tariff")
}

model Sims {
  id                   Int         @id @default(autoincrement())
  status               OrderStatus
  partner_id           Int
  order_id             Int?
  user_id              Int
  tariff_id            Int
  order_tid            String?
  order_code           String?
  sn_code              String?
  sn_pin               String?
  product_expire_date  String?
  coupon               String?
  qrcode_type          Int?
  qrcode               String?
  cid                  String?
  sale_plan_name       String?
  sale_plan_days       String?
  pin_1                String?
  pin_2                String?
  puk_1                String?
  puk_2                String?
  outbound_code        String?
  customer_code        String?
  product_code         String?
  channel_order_id     String?
  partner_order_id     String?
  uid                  String?
  iccid                String?
  sub_order_id         String?
  channel_sub_order_id String?
  msisdn               String?
  apn                  String?
  main_region_id       Int?

  user        User    @relation(fields: [user_id], references: [id])
  partner     Partner @relation(fields: [partner_id], references: [id])
  tariff      Tariff  @relation(fields: [tariff_id], references: [id])
  order       Order?  @relation(fields: [order_id], references: [id])
  main_region Region? @relation(fields: [main_region_id], references: [id])

  request  Json?
  response Json?

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("sims")
}

model Partner {
  id                Int     @id @default(autoincrement())
  name_ru           String
  name_en           String
  description_ru    String?
  description_en    String?
  image             String?
  status            Status
  identified_number Int?

  sims   Sims[]
  tariff Tariff[]

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("partner")
}

model Order {
  id      Int         @id @default(autoincrement())
  status  OrderStatus
  user_id Int

  user User   @relation(fields: [user_id], references: [id])
  sims Sims[]

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("order")
}

model Basket {
  id         Int          @id @default(autoincrement())
  user_id    Int?
  session_id String?
  status     BasketStatus @default(ACTIVE)
  user       User?        @relation(fields: [user_id], references: [id])

  items BasketItem[]

  created_at DateTime @default(now()) @db.Timestamptz(5)
  updated_at DateTime @updatedAt @db.Timestamptz(5)

  @@map("basket")
}

model BasketItem {
  id        Int    @id @default(autoincrement())
  basket_id Int
  tariff_id Int?
  region_id Int?
  quantity  Int    @default(1)
  price     String

  basket Basket  @relation(fields: [basket_id], references: [id])
  tariff Tariff? @relation(fields: [tariff_id], references: [id])
  region Region? @relation("basketitem_to_region", fields: [region_id], references: [id])

  created_at DateTime @default(now()) @db.Timestamptz(5)
  updated_at DateTime @updatedAt @db.Timestamptz(5)

  @@map("basket_item")
}

model Faq {
  id          Int     @id @default(autoincrement())
  question_ru String?
  question_en String?
  answer_ru   String?
  answer_en   String?
  status      Status? @default(ACTIVE)

  created_at DateTime @default(now()) @db.Timestamptz(5)
  updated_at DateTime @updatedAt @db.Timestamptz(5)

  @@map("faqs")
}

enum Status {
  ACTIVE
  INACTIVE
}

enum BasketStatus {
  PENDING
  ORDERED
  ACTIVATED
  FAILED
  ACTIVE
}

enum OrderStatus {
  CREATED
  REDEEM_COUPON
  NOTIFY_COUPON
  COMPLETED
  PENDING
  FAILED
}

enum OrderJobStatus {
  PENDING
  SUCCESS
  ERROR
}

enum UserRoles {
  SUPER_ADMIN
  ADMIN
  ACCOUNTANT
  PRE_ACCOUNTANT
}

enum TariffType {
  ECONOMY
  STANDARD
  TURBO
}
