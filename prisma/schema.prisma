// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          Int     @id @default(autoincrement())
  name        String?
  email       String?
  password    String?
  is_verified Boolean @default(false)
  fcm_token   String?

  transaction Transaction[]
  basket      Basket[]
  orders      Order[]
  sims        Sims[]

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("user")
}

model Staff {
  id       Int    @id @default(autoincrement())
  name     String
  login    String
  password String
  status   Status

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("staff")
}

model Region {
  id      Int     @id @default(autoincrement())
  name_ru String
  name_en String
  image   String?
  status  Status

  cities  City[]
  tariffs Tariff[] @relation("tariff_regions")

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("region")
}

model City {
  id      Int    @id @default(autoincrement())
  name_ru String
  name_en String
  status  Status

  region_id Int
  region    Region @relation(fields: [region_id], references: [id])

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("city")
}

model Transaction {
  id     Int    @id @default(autoincrement())
  amount String
  status Status

  user_id Int
  user    User @relation(fields: [user_id], references: [id])

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("transaction")
}

model Tariff {
  id             Int     @id @default(autoincrement())
  name_ru        String
  name_en        String
  title_ru       String?
  title_en       String?
  description_ru String?
  description_en String?
  status         Status
  is_popular     Boolean @default(false)
  is_4g          Boolean @default(false)
  is_5g          Boolean @default(false)

  partner_id Int

  regions  Region[]  @relation("tariff_regions")
  partner  Partner   @relation(fields: [partner_id], references: [id])
  packages Package[]

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("tariff")
}

model Package {
  id            Int    @id @default(autoincrement())
  sms_count     Int?
  minutes_count Int?
  mb_count      Int?
  sku_id        String
  status        Status
  cost          Int?
  comission     Int?

  tariff_id   Int
  tariff      Tariff       @relation(fields: [tariff_id], references: [id])
  orders      Order[]
  bascet_item BasketItem[]
  sims        Sims[]

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("package")
}

model Sims {
  id                   Int         @id @default(autoincrement())
  status               OrderStatus
  partner_id           Int
  order_id             Int?
  user_id              Int
  package_id           Int
  order_tid            String?
  order_code           String?
  sn_code              String?
  sn_pin               String?
  product_expire_date  String?
  coupon               String?
  qrcodeType           Int?
  qrcode               String?
  cid                  String?
  sale_plan_name       String?
  sale_plan_days       String?
  pin_1                String?
  pin_2                String?
  puk_1                String?
  puk_2                String?
  outbound_code        String?
  customer_code        String?
  product_code         String?
  channel_order_id     String?
  partner_order_id     String?
  uid                  String?
  iccid                String?
  sub_order_id         String?
  channel_sub_order_id String?
  msisdn               String?
  apn                  String?

  user    User    @relation(fields: [user_id], references: [id])
  partner Partner @relation(fields: [partner_id], references: [id])
  package Package @relation(fields: [package_id], references: [id])
  Order   Order?  @relation(fields: [order_id], references: [id])

  request  Json?
  response Json?

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("sims")
}

model Partner {
  id                Int     @id @default(autoincrement())
  name_ru           String
  name_en           String
  description_ru    String?
  description_en    String?
  image             String?
  status            Status
  identified_number Int?

  sims   Sims[]
  tariff Tariff[]

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("partner")
}

model Order {
  id         Int         @id @default(autoincrement())
  status     OrderStatus
  user_id    Int
  package_id Int?

  user    User     @relation(fields: [user_id], references: [id])
  package Package? @relation(fields: [package_id], references: [id])

  sims Sims[]

  request  Json?
  response Json?

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("order")
}

model OrderJob {
  id       Int @id @default(autoincrement())
  order_id Int

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("order_job")
}

model Basket {
  id         Int          @id @default(autoincrement()) // UUID foydalidir session uchun
  user_id    Int? // optional, ro‘yxatdan o‘tmaganlar uchun null bo‘lishi mumkin
  session_id String? // cookie orqali saqlanadigan identifikator
  status     BasketStatus @default(ACTIVE) // ACTIVE, CHECKED_OUT, EXPIRED

  items BasketItem[]

  created_at DateTime @default(now()) @db.Timestamptz(5)
  updated_at DateTime @updatedAt @db.Timestamptz(5)
  user       User?    @relation(fields: [user_id], references: [id])

  @@map("basket")
}

model BasketItem {
  id         Int    @id @default(autoincrement())
  basket_id  Int
  package_id Int
  quantity   Int    @default(1)
  price      String

  basket  Basket  @relation(fields: [basket_id], references: [id])
  package Package @relation(fields: [package_id], references: [id])

  created_at DateTime @default(now()) @db.Timestamptz(5)
  updated_at DateTime @updatedAt @db.Timestamptz(5)

  @@map("basket_item")
}

model Error {
  id      Int  @id @default(autoincrement())
  code    Int
  message Json

  created_at DateTime  @default(now()) @db.Timestamptz(5)
  updated_at DateTime? @updatedAt @db.Timestamptz(5)

  @@map("error")
}

enum Status {
  ACTIVE
  INACTIVE
}

enum BasketStatus {
  PENDING
  ORDERED
  ACTIVATED
  FAILED
  ACTIVE
}

enum OrderStatus {
  CREATED
  REDEEM_COUPON
  NOTIFY_COUPON
  COMPLETED
  PENDING
  FAILED
}

enum OrderJobStatus {
  PENDING
  SUCCESS
  ERROR
}
